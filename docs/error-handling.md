# エラー処理とリカバリーガイド

## エラーコードと対処方法

### E001: ファイルが見つかりません
#### 現在の状態
- エラー詳細にファイルパスが含まれます
- 分析は利用可能なファイルで継続されます
- エラーログに詳細が記録されます

#### 分析の動作
- エラーが発生したファイルはスキップされます
- 他のファイルの分析は継続されます
- 最終レポートにスキップされたファイルが記録されます

#### リカバリーオプション
1. ファイルパスの確認
   - 指定したパスが正しいか確認
   - ファイルの存在を確認
2. アクセス権限の確認
   - ファイルの読み取り権限を確認
   - 必要に応じて権限を調整
3. 除外パターンの確認
   - 意図せずに除外されていないか確認
   - 必要に応じて除外パターンを調整

### E002: パースエラー
#### 現在の状態
- エラーが発生したファイルの場所が記録されます
- 構文エラーの詳細が含まれます
- デバッグモードでより詳細な情報が提供されます

#### 分析の動作
- エラーファイルはスキップされ、他のファイルの分析は継続
- エラー発生箇所の行番号が記録されます
- パース失敗の理由が記録されます

#### リカバリーオプション
1. ファイルの構文確認
   - コードフォーマッターの実行
   - 構文エラーの修正
2. エンコーディングの確認
   - UTF-8エンコーディングの確認
   - BOMの有無を確認
3. 問題のあるファイルの除外
   - 一時的な除外設定の追加
   - 分析後に個別に確認

### E003: メモリ制限超過
#### 現在の状態
- 現在のメモリ使用量が記録されます
- 設定された制限値が記録されます
- メモリ使用量の詳細な統計が提供されます

#### 分析の動作
- 安全に分析を停止します
- 部分的な結果が返されます
- メモリ使用量の統計が記録されます

#### リカバリーオプション
1. メモリ制限の調整
   - プロジェクトサイズに応じた推奨値の設定
   - 段階的な制限値の増加
2. バッチ処理の利用
   - ファイルを小さなグループに分割
   - 順次処理の実行
3. 並行処理の最適化
   - maxConcurrentProcessesの調整
   - メモリ使用量の監視

### E004: 設定が無効です
#### 現在の状態
- 無効な設定項目が特定されます
- デフォルト値が提案されます
- 設定スキーマ違反の詳細が提供されます

#### 分析の動作
- 設定の検証に失敗します
- エラー詳細が記録されます
- 推奨設定が提示されます

#### リカバリーオプション
1. 設定値の確認
   - 各設定項目の型を確認
   - 値の範囲を確認
2. デフォルト値の使用
   - 推奨設定の適用
   - 段階的な設定の調整
3. 設定ファイルの検証
   - JSONスキーマの確認
   - 設定例との比較

## メモリ使用量の推奨設定

プロジェクトの規模に応じた推奨メモリ設定：

### 小規模プロジェクト（1000ファイル未満）
- メモリ制限: 1GB
- 並行処理数: 2-4
- 推奨設定:
```json
{
  "memoryLimit": 1073741824,
  "maxConcurrentProcesses": 2
}
```

### 中規模プロジェクト（1000-5000ファイル）
- メモリ制限: 2GB
- 並行処理数: 4-6
- 推奨設定:
```json
{
  "memoryLimit": 2147483648,
  "maxConcurrentProcesses": 4
}
```

### 大規模プロジェクト（5000ファイル以上）
- メモリ制限: 4GB
- 並行処理数: 6-8
- 推奨設定:
```json
{
  "memoryLimit": 4294967296,
  "maxConcurrentProcesses": 6
}
```

## パフォーマンスモニタリング

### メモリ使用量の監視
- `process.memoryUsage()` による定期的な監視
- ヒープ使用量のトラッキング
- RSS（常駐セットサイズ）の監視

### 進捗レポート
- ファイル処理の進捗表示
- メモリ使用量の定期的な報告
- エラー発生時の詳細なログ

### デバッグモード
デバッグモードを有効にすることで、より詳細な情報が提供されます：
```json
{
  "debug": true
}
```

これにより以下の情報が追加で出力されます：
- 詳細なメモリ使用量統計
- ファイル処理の詳細なログ
- エラーのスタックトレース
